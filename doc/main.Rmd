---
title: "Project 4 - Collaborative Filtering Algorithms Evaluation"
author: "Fangbing Liu"
date: "Spring 2018"
output: pdf_document
---

# Memory-based Algorithm

## Load the packages, specify directories

```{r}
# if (!require("pacman")) install.packages("pacman")
# pacman::p_load(text2vec, dplyr, qlcMatrix, kernlab, knitr)
# 
# setwd("~/Dropbox/Project4_WhoIsWho/doc")
# # here replace it with your own path or manually set it in RStudio
# # to where this rmd file is located
```

## Load and process the data

```{r}
## Load data
MStrain <- read.csv("../data/MS_sample/data_train.csv")
MStest  <- read.csv("../data/MS_sample/data_test.csv")
Movietrain <- read.csv("../data/eachmovie_sample/data_train.csv")
Movietest  <- read.csv("../data/eachmovie_sample/data_test.csv")

## Data Processing

# Using function in Process_Data.R to transform the dataset.

# source("../lib/Process_Data.R")
# Movie_train <- Movie_data(Movietrain)
# Movie_test  <- Movie_data(Movietest)
# save(Movie_train, file = "../output/data/Movie_train.RData")
# save(Movie_test, file = "../output/data/Movie_test.RData")


# Here, we directly load the processed dataset.

load("../output/data/MS_train.RData")
load("../output/data/Movie_train.RData")
load("../output/data/MS_test.RData")
load("../output/data/Movie_test.RData")
```

## Similarity Weight

### 1. Pearson Correlation
We will directly load our data into this file.
```{r}
# source("../lib/Pearson_MeanSquare.R")

## MS Data

# weight_pearson_MS <- cor(t(MS_train), method = "pearson")
# save(weight_pearson_MS, file = "../output/Similarity_Weight/weight_pearson_MS.RData")
load("../output/Similarity_Weight/weight_pearson_MS.RData")

## Movie Data

# weight_pearson_Movie <- cor(t(Movie_train), method = "pearson", use = "pairwise.complete.obs")
# save(weight_pearson_Movie, file = "../output/Similarity_Weight/weight_pearson_Movie.RData")
load("../output/Similarity_Weight/weight_pearson_Movie.RData")
```

### 2. Mean-squared-difference
```{r}
## MS Data

# weight_MSD_MS <- MSD(MS_train)
# save(weight_MSD_MS, file = "../output/Similarity_Weight/weight_MSD_MS.RData")
load("../output/Similarity_Weight/weight_MSD_MS.RData")

## Movie Data

# weight_MSD_Movie <- MSD(Movie_train)
# save(weight_MSD_Movie, file = "../output/Similarity_Weight/weight_MSD_Movie.RData")
load("../output/Similarity_Weight/weight_MSD_Movie.RData")
```

### 3. SimRank
```{r}

```

## Variance Weighting 
```{r}
# source("../lib/var_weight.R")
# 
# var_weight_MS <- var_weight_matrix(mat = MS_train)
# var_weight_MS[is.na(var_weight_MS)] = 0
# var_weight_MS <- round(var_weight_MS,3)
# save(var_weight_MS, file = "../output/var_weight_MS.RData")
load("../output/var_weight_MS.RData")
 
# var_weight_Movie <- var_weight_matrix(mat = Movie_train)
# var_weight_Movie[is.na(var_weight_Movie)] = 0
# var_weight_Movie <- round(variance_weight_Movie,3)
# save(var_weight_Movie, file = "../output/var_weight_Movie.RData")
load("../output/var_weight_Movie.RData")
```

## Selecting Neighborhoods

### Best-n neighbors & Prediction
```{r}
source("../lib/neighbor&predict.R")
# MS Data:
# Pearson
pearson_MS_neighbor = neighbors.select(weight_pearson_MS, N=20)
pearson_MS_pred = predict.MS(sim_weights = weight_pearson_MS, 
                             top.neighbors = pearson_MS_neighbor)

# MSD
MSD_MS_neighbor = neighbors.select(weight_MSD_MS, N=20)
MSD_MS_pred = predict.MS(sim_weights = weight_MSD_MS, 
                             top.neighbors = MSD_MS_neighbor)
# Pearson + Var
pearson_var_MS = var_weight_MS * weight_pearson_MS
pearson_var_MS_neighbor = neighbors.select(pearson_var_MS,N=20)
pearson_var_MS_pred = predict.MS(sim_weights =pearson_var_MS, 
                                 top.neighbors = pearson_var_MS_neighbor)

# MSD + Var
MSD_var_MS = var_weight_MS * weight_MSD_MS
MSD_var_MS_neighbor = neighbors.select(MSD_var_MS,N=20)
MSD_var_MS_pred = predict.MS(sim_weights =MSD_var_MS, 
                                 top.neighbors = MSD_var_MS_neighbor)

# Movie Data:
# Pearson
pearson_Movie_neighbor =  neighbors.select(weight_pearson_Movie, N=20)
pearson_Movie_pred = predict.Movie(sim_weights = weight_pearson_Movie,
                                   top.neighbors = pearson_Movie_neighbor)

# MSD
MSD_Movie_neighbor =  neighbors.select(weight_MSD_Movie, N=20)
MSD_Movie_pred = predict.Movie(sim_weights = weight_MSD_Movie,
                                   top.neighbors = MSD_Movie_neighbor)

# SimRank
# simrank_Movie_neighbor =  neighbors.select(simrank_Movie, N=20)
# simrank_Movie_pred = predict.Movie(sim_weights = simrank_Movie,
#                                    top.neighbors = simrank_Movie_neighbor)

# Pearson + Var
pearson_var_Movie = var_weight_Movie * weight_pearson_Movie
pearson_var_Movie_neighbor =  neighbors.select(pearson_var_Movie, N=20)
pearson_var_Movie_pred = predict.Movie(sim_weights = pearson_var_Movie,
                                       top.neighbors = pearson_var_Movie_neighbor)

# MSD + Var
MSD_var_Movie = var_weight_Movie * weight_MSD_Movie
MSD_var_Movie_neighbor =  neighbors.select(MSD_var_Movie, N=20)
MSD_var_Movie_pred = predict.Movie(sim_weights = MSD_var_Movie,
                                       top.neighbors = MSD_var_Movie_neighbor)


# SimRank + Var
# simrank_var_Movie = var_weight_Movie * simrank_Movie
# simrank_var_Movie_neighbor =  neighbors.select(simrank_var_Movie, N=20)
# simrank_var_Movie_pred = predict.Movie(sim_weights = simrank_var_Movie,
#                                        top.neighbors = simrank_var_Movie_neighbor)

```

# Model-based Algorithms(Cluster Model)
```{r}

```

# Evaluation 
```{r}
source("../lib/Evaluation.R")
```

### MS Dataset
### Rank Score
```{r}
pearson_rankscore_MS <- rank_score(pearson_MS_pred, MS_test)
pearson_var_rankscore_MS <- rank_score(pearson_var_MS_pred, MS_test)

MSD_rankscore_MS <- rank_score(MSD_MS_pred, MS_test)
MSD_var_rankscore_MS <- rank_score(MSD_var_MS_pred, MS_test)

pearson_rankscore_MS
pearson_var_rankscore_MS
MSD_rankscore_MS
MSD_var_rankscore_MS
```

### EachMovie Dataset
### MAE
```{r}
pearson_MAE_Movie <- MAE(pearson_Movie_pred, Movie_test)
pearson_var_MAE_Movie <- MAE(pearson_var_Movie_pred, Movie_test)

MSD_MAE_Movie <- MAE(MSD_Movie_pred, Movie_test)
MSD_var_MAE_Movie <- MAE(MSD_var_Movie_pred, Movie_test)

```

### ROC
```{r}

```

